# GitHub Actions Release + Docker Build Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Add GitHub Actions workflows to build/publish GHCR images on non-main branches and create date-based releases on main that trigger a release build.

**Architecture:** Use one workflow for branch builds (non-main, plus workflow_dispatch with optional tag) and a separate workflow that computes the monthly release tag from existing Git tags, creates a GitHub release with autogenerated notes, and dispatches the build workflow with the release tag.

**Tech Stack:** GitHub Actions, GHCR, bash, actions/github-script.

### Task 1: Add docker build workflow

**Files:**
- Create: `.github/workflows/docker-build.yml`

**Step 1: Write the failing test**

```python
def test_docker_build_workflow_exists() -> None:
    from pathlib import Path

    assert Path(".github/workflows/docker-build.yml").exists()
```

**Step 2: Run test to verify it fails**

Run: `pytest tests/test_ci.py::test_docker_build_workflow_exists -v`
Expected: FAIL because workflow file does not exist.

**Step 3: Write minimal implementation**

```yaml
name: Docker Build
on:
  push:
    branches-ignore:
      - main
  workflow_dispatch:
    inputs:
      tag:
        required: false
        type: string
```

**Step 4: Run test to verify it passes**

Run: `pytest tests/test_ci.py::test_docker_build_workflow_exists -v`
Expected: PASS

**Step 5: Commit**

```bash
```

### Task 2: Add release-on-main workflow

**Files:**
- Create: `.github/workflows/release-on-main.yml`

**Step 1: Write the failing test**

```python
def test_release_workflow_exists() -> None:
    from pathlib import Path

    assert Path(".github/workflows/release-on-main.yml").exists()
```

**Step 2: Run test to verify it fails**

Run: `pytest tests/test_ci.py::test_release_workflow_exists -v`
Expected: FAIL because workflow file does not exist.

**Step 3: Write minimal implementation**

```yaml
name: Release on Main
on:
  push:
    branches:
      - main
```

**Step 4: Run test to verify it passes**

Run: `pytest tests/test_ci.py::test_release_workflow_exists -v`
Expected: PASS

**Step 5: Commit**

```bash
```

### Task 3: Implement tag computation + dispatch

**Files:**
- Modify: `.github/workflows/release-on-main.yml`
- Modify: `.github/workflows/docker-build.yml`

**Step 1: Write the failing test**

```python
def test_release_workflow_has_dispatch() -> None:
    from pathlib import Path

    content = Path(".github/workflows/release-on-main.yml").read_text()
    assert "workflow_dispatch" in content
```

**Step 2: Run test to verify it fails**

Run: `pytest tests/test_ci.py::test_release_workflow_has_dispatch -v`
Expected: FAIL because dispatch logic is missing.

**Step 3: Write minimal implementation**

```yaml
      - name: Compute release tag
        run: |
          # derive YYYY.MM.NN from git tags
      - name: Create GitHub release
        uses: actions/github-script@v7
      - name: Dispatch docker build
        uses: actions/github-script@v7
```

**Step 4: Run test to verify it passes**

Run: `pytest tests/test_ci.py::test_release_workflow_has_dispatch -v`
Expected: PASS

**Step 5: Commit**

```bash
```
